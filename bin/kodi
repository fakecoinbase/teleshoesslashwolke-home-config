#!/usr/bin/perl
use strict;
use warnings;
use Time::HiRes qw(sleep);

sub run(@);

sub main(@){
  my @kodiArgs = @_;

  my $keysPid = fork;
  if($keysPid == 0){
    sleep 1;
    exec "keys-to-window", "kodi";
    exit 0;
  }

  run "/usr/bin/kodi", @kodiArgs;
  run "kill", $keysPid;
  run "stty", "sane";
}

sub run(@){
  print "@_\n";
  system @_;
}

&main(@ARGV);
